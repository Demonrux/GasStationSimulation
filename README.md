#  Gas Station Simulation 

Проект для многопоточного моделирования работы автозаправочной станции с использованием асинхронного программирования и современных паттернов проектирования.

## Описание проекта

Система имитирует работу АЗС как конвейерной модели с несколькими этапами обработки:
- **Генерация автомобилей** и **бензовозов** 
- **Многопоточная заправка** автомобилей
- **Очередь оплаты** с балансировкой нагрузки
- **Сбор статистики** в реальном времени
- **Гибкая конфигурация** через CSV-файлы
## Диаграмма классов
<img width="2069" height="663" alt="dot_inline_dotgraph_1" src="https://github.com/user-attachments/assets/81401c5f-417e-4ae4-9947-ef66f99899ab" />


##  Структура решения

```text
GasStationModel/
├── GasStation.Core/           # Основные модели и утилиты
│   ├── Models/
│   │   ├── Car.cs
│   │   ├── FuelTruck.cs
│   │   ├── FuelTank.cs
│   │   ├── CarQueue.cs
│   │   └── Constants.cs
│   ├── Workers/
│   │   ├── Worker.cs
│   │   ├── Refueller.cs
│   │   ├── Cashier.cs
│   │   └── WorkerPool.cs
│   ├── Enums/
│   │   └── CarState.cs
│   └── Utils/
│       └── TimingCalculator.cs
├── GasStation.Services/       # Бизнес-логика
│   ├── Generators/
│   │   ├── CarGenerator.cs
│   │   └── FuelTruckGenerator.cs
│   ├── Classes/
│   │   ├── RefuelService.cs
│   │   └── PaymentService.cs
│   └── Interfaces/
│       ├── IGenerator.cs
│       └── IService.cs
├── GasStation.Engine/         # Движок симуляции
│   ├── Classes/
│   │   ├── GasStationEngine.cs
│   │   └── GasStationFactory.cs
│   └── Interfaces/
│       └── IEngine.cs
├── GasStation.FileOperations/ # Работа с файлами
│   ├── Classes/
│   │   ├── CsvConfigReader.cs
│   │   └── Logger.cs
│   └── Interfaces/
│       ├── IConfigReader.cs
│       └── ILogger.cs
└── GasStation/                # Запускаемый проект
    ├── Files/
    │   ├── config.csv
    │   └── log.txt
    └── Program.cs
```

## Запуск проекта
Требования
- .NET 6.0 или выше
- CSV файл конфигурации в папке GasStation/Files/

## Компиляция и запуск
```bash
cd GasStation
dotnet run
```
## Конфигурация
config.csv
```csv
SimulationDurationSeconds,20
CarGenerationInterval,3
FuelTruckGenerationInterval,15
RefuellerCount,2
CashierCount,1
FuelTankCapacity,1500
InitialFuelLevel,300
```
## Параметры конфигурации:
- **`SimulationDurationSeconds`** - длительность симуляции в секундах
- **`CarGenerationInterval`** - интервал генерации машин (секунды)
- **`FuelTruckGenerationInterval`** - интервал генерации бензовозов (секунды)
- **`RefuellerCount`** - количество заправщиков
- **`CashierCount`** - количество кассиров
- **`FuelTankCapacity`** - емкость топливного резервуара
- **`InitialFuelLevel`** - начальный уровень топлива
  
## Ключевые классы
### - **`GasStationEngine`**
#### Назначение: Основной движок симуляции, координирует все компоненты
#### Основные методы:
-  **`RunSimulation()`** - запуск симуляции
-  **`MonitorSimulation()`** - мониторинг выполнения
-  **`Stop()`** - остановка симуляции
-  События: Управляет событиями генераторов и сервисов

### **`CarGenerator & FuelTruckGenerator`**
#### Назначение: Генерация поступающих автомобилей и бензовозов
- Реализует:  **`IGenerator<T>`**
- Особенности: Асинхронная генерация с настраиваемыми интервалами

### **`RefuelService & PaymentService`**
#### Назначение: Обработка автомобилей на этапах заправки и оплаты
- Реализует: **`IService<T>`**
- Логика: Балансировка нагрузки между работниками через **`WorkerPool`**

### **`WorkerPool<T>`**
#### Назначение: Управление пулом работников с Round-robin балансировкой
#### Методы:
- **`TryAssignWork()`** - назначение работы свободному работнику
- **`SubscribeToWorkEvents()`** - подписка на события работников

### **`FuelTank`**
#### Назначение: Управление топливным резервуаром АЗС
#### Методы:
- **`TryReserveFuel()`** - резервирование топлива для заправки
- **`Refuel()`** - пополнение запасов от бензовозов
- События: **`FuelLevelChanged`**, FuelLow`**

### **`TimingCalculator`**
#### Назначение: Расчет временных интервалов для операций
#### Методы:
- **`Refueling()`** - время заправки в зависимости от объема
- **`Payment()`** - время обработки оплаты
- **`CarGeneration()`** - вариативный интервал генерации

## Рабочий процесс
- Генерация → **`CarGenerator`** создает автомобили, **`FuelTruckGenerator`** - бензовозы
- Очередь заправки → Автомобили поступают в **`CarQueue`**
- Заправка → **`RefuelService`** назначает свободного**` Refueller`**
- Очередь оплаты → Заправленные автомобили переходят в очередь оплаты
- Оплата → **`PaymentService`** назначает свободного **`Cashier`**
- Завершение → Обслуженные автомобили покидают АЗС

## Выходные данные
Статистика симуляции
```text
============================================================
СТАТИСТИКА МОДЕЛИРОВАНИЯ
============================================================
Длительность моделирования: 20,0 сек
Всего сгенерировано машин: 8
Обслужено машин (заправка): 2
Обслужено машин (оплата): 1
Всего бензовозов: 1
Доставлено топлива: 357л
Топлива в резервуаре: 573л
Максимальная очередь заправки: 4 машин
Максимальная очередь оплаты: 1 машин
Статистика заправщиков:
  • Заправщик 1: 2 машин
Статистика кассиров:
  • Кассир 1: 1 машин
============================================================
```

## Логирование
Подробное логирование всех событий в реальном времени в файл log.txt

## Технические особенности
### Многопоточность
- **`Async/Await`** для асинхронных операций
- **`CancellationToken`** для плавного завершения работы
- **`ConcurrentQueue`** для потокобезопасных очередей
- **`Lock/Interlocked`** для синхронизации

### Паттерны проектирования
- **`Factory Method`** (GasStationFactory)
- **`Worker Pool`** (WorkerPool<T>)
- **`Observer`** (событийная модель)
- **`Strategy`** (сервисы обработки)
- **`Dependency Injection`** (внедрение зависимостей)

## Анализ производительности
Система позволяет анализировать:
- Пропускную способность АЗС
- Загрузку работников
- Длины очередей и узкие места
- Эффективность балансировки нагрузки
- Длины очередей и узкие места
- Эффективность балансировки нагрузки
